
# üè¢ Organizations Directory API

RESTful API –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è—Ö, –∏—Ö –∑–¥–∞–Ω–∏—è—Ö –∏ –≤–∏–¥–∞—Ö –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏. –ü—Ä–æ–µ–∫—Ç –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã, —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ –∏ –≤–µ–±‚Äë–ø–æ—Ä—Ç–∞–ª—ã.

## ‚öôÔ∏è –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

- Python 3.13
- FastAPI 0.116 (ASGI)
- SQLAlchemy 2 (async)
- PostgreSQL 15
- Alembic ‚Äî –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
- Docker + docker‚Äëcompose
- API‚Äë–∫–ª—é—á–∏ (–∑–∞–≥–æ–ª–æ–≤–æ–∫ `X‚ÄëAPI‚ÄëKEY`)

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

```bash
git clone https://github.com/NeewMeta88/org_finder_api.git
cd org_finder_api
```

### 2. –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
python -m venv .venv
source .venv/bin/activate      # Windows ‚Üí .venv\Scripts\activate
pip install -r requirements.txt
```

### 3. –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ñ–∞–π–ª `.env`
–ü—Ä–∏–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ (—Å–º. `.env.example`):

```
API_KEY=super‚Äësecret‚Äëkey
DATABASE_URL=postgresql+asyncpg://user:pass@db:5432/db
POSTGRES_USER=user
POSTGRES_PASSWORD=pass
POSTGRES_DB=db
```

### 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å

```bash
docker-compose up --build
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É **http://localhost:8000**.  

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
Swagger –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É **/docs**,  
–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è ‚Äî **/redoc**.

---

### 5. –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
–í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é:
```bash
docker-compose run --rm web alembic upgrade head
```
–ó–∞—Ç–µ–º –Ω–∞–∫–∞—Ç–∏—Ç–µ (–¥–∞–Ω–Ω—ã–µ) –¥–ª—è —Ç–µ—Å—Ç–∞
```bash
docker-compose run --rm web python app/initial_data.py
```

---

## üîë –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–î–ª—è –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å API‚Äë–∫–ª—é—á–æ–º:

```
X-API-KEY: super‚Äësecret‚Äëkey
```

–ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω–æ–º –∫–ª—é—á–µ —Å–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—ë—Ç **401 Unauthorized**.

---

## üìö API‚Äë—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

| –ú–µ—Ç–æ–¥   | URL                                       | –û–ø–∏—Å–∞–Ω–∏–µ                                                               | –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è |
| ------- | ----------------------------------------- | ---------------------------------------------------------------------- | -------------- |
| **GET** | `/organizations/`                         | –ü–æ–∏—Å–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –ø–æ —Ñ–∏–ª—å—Ç—Ä–∞–º (`name`, `activity_id`)                  | ‚úÖ –î–∞           |
| **GET** | `/organizations/search`                   | –ü–æ–∏—Å–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –ø–æ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–ª–∏ —Ä–∞–¥–∏—É—Å)                | ‚úÖ –î–∞           |
| **GET** | `/organizations/{organization_id}`        | –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏                                    | ‚úÖ –î–∞           |
| **GET** | `/activities/{activity_id}/organizations` | –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –≤–∏–¥–∞ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–≤–∫–ª—é—á–∞—è –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏) | ‚úÖ –î–∞           |
| **GET** | `/buildings/{building_id}/organizations`  | –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω—ã–µ –≤ –∑–¥–∞–Ω–∏–∏                                    | ‚úÖ –î–∞           |

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|----------|
| `name` | `str` | –ü–æ–¥—Å—Ç—Ä–æ–∫–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é |
| `activity_id` | `int` | –§–∏–ª—å—Ç—Ä –ø–æ ID –≤–∏–¥–∞ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ |
| `building_id` | `int` | –§–∏–ª—å—Ç—Ä –ø–æ ID –∑–¥–∞–Ω–∏—è |

---

## üí° –ë–∏–∑–Ω–µ—Å‚Äë–ø—Ä–∞–≤–∏–ª–∞

- –ü–æ–∏—Å–∫ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∫ —Ä–µ–≥–∏—Å—Ç—Ä—É –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç LIKE‚Äë—Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ.
- –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –ø–æ –≤–∏–¥—É –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ 3‚Äë–≥–æ —É—Ä–æ–≤–Ω—è.
- –î–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –ë–î –∏ –∏–Ω–¥–µ–∫—Å—ã –ø–æ –ø–æ–ª—è–º `name`, `activity_id`, `building_id`.

---

## üìé –ü—Ä–∏–º–µ—Ä—ã cURL

**üîç –ü–æ–∏—Å–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –ø–æ —Ñ–∏–ª—å—Ç—Ä–∞–º (–Ω–∞–∑–≤–∞–Ω–∏–µ –∏/–∏–ª–∏ ID –≤–∏–¥–∞ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)**

```bash
curl -X GET "http://localhost:8000/organizations/?name=–ë–µ—Ç–∞–ö–æ–Ω—Å–∞–ª—Ç&activity_id=2" \
  -H "X-API-KEY: super-secret-key"
```

**üìç –ü–æ–∏—Å–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –ø–æ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ (—Ä–∞–¥–∏—É—Å)**

```bash
curl -X GET "http://localhost:8000/organizations/search?lat=55.7605&lon=37.6402&radius=1" \
  -H "X-API-KEY: super-secret-key"
```

**üó∫Ô∏è –ü–æ–∏—Å–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –ø–æ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏**

```bash
curl -X GET "http://localhost:8000/organizations/search?lat_min=55.5&lat_max=56.6&lon_min=37.3&lon_max=38.4" \
  -H "X-API-KEY: super-secret-key"
```

**üè¢ –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –≤ –∑–¥–∞–Ω–∏–∏**

```bash
curl -X GET "http://localhost:8000/buildings/2/organizations" \
  -H "X-API-KEY: super-secret-key"
```

**‚öôÔ∏è –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ –≤–∏–¥—É –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–≤–∫–ª—é—á–∞—è –≤–ª–æ–∂–µ–Ω–Ω—ã–µ)**

```bash
curl -X GET "http://localhost:8000/activities/3/organizations" \
  -H "X-API-KEY: super-secret-key"
```

**üìù –î–µ—Ç–∞–ª–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ ID**

```bash
curl -X GET "http://localhost:8000/organizations/1" \
  -H "X-API-KEY: super-secret-key"
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
docker-compose exec web pytest
```

–ü–æ–∫—Ä—ã–≤–∞—é—Ç—Å—è:
- —Å–µ—Ä–≤–∏—Å–Ω—ã–µ —Å–ª–æ–∏ (business‚Äëlogic)
- –º–∞—Ä—à—Ä—É—Ç—ã API

---

## üóÑ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

```bash
# —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
alembic revision -m "add new table"
# –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ
alembic upgrade head
```

---

## üßë‚Äçüíª –ê–≤—Ç–æ—Ä

*–ï–≥–æ—Ä –†–æ–¥–∏–æ–Ω–æ–≤*